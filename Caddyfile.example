# Configuração Caddyfile para StockBit
# Copie este arquivo para seu Caddyfile ou adicione ao seu Caddyfile existente

seu-dominio.com {
    # Proxy para o container Docker
    reverse_proxy localhost:8000 {
        # Opções de timeout
        header_up Connection "Keep-Alive"
        
        # Timeouts
        transport http {
            dial_timeout 10s
            response_header_timeout 30s
            idle_timeout 90s
        }
    }
    
    # Servir arquivos estáticos (opcional - pode servir direto do Caddy também)
    handle /static/* {
        reverse_proxy localhost:8000
    }
    
    # Servir arquivos de media (upload)
    handle /media/* {
        reverse_proxy localhost:8000
    }
    
    # Headers de segurança
    header {
        -Server
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "no-referrer-when-downgrade"
        -Referrer-Policy
    }
    
    # Compressão
    encode gzip zstd
    
    # Logs
    log {
        output file /var/log/caddy/stockbit.log {
            roll_size 100mb
            roll_keep 10
        }
    }
    
    # TLS automático (Let's Encrypt)
    tls {
        protocols tls1.2 tls1.3
    }
}

