import os
import django
from django.core.management import execute_from_command_line

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'inventory_api.settings')
django.setup()

from django.contrib.auth import get_user_model
from apps.products.models import Category, Product
from apps.stock.models import StockMovement
from apps.contacts.models import Client, Supplier
from decimal import Decimal

User = get_user_model()

def create_initial_data():
    """Cria dados iniciais para o sistema"""
    
    # Criar usu√°rio admin
    if not User.objects.filter(username='admin').exists():
        admin_user = User.objects.create_user(
            username='admin',
            email='admin@stockbit.com',
            password='admin123',
            first_name='Administrador',
            last_name='Sistema',
            is_staff=True,
            is_superuser=True
        )
        print(f"Usu√°rio admin criado: {admin_user.email}")
    else:
        admin_user = User.objects.get(username='admin')
        print("Usu√°rio admin j√° existe")

    # Criar categorias para empresa de tecidos, pap√©is e tintas
    categories_data = [
        {'name': 'Tecidos', 'description': 'Tecidos diversos para confec√ß√£o e decora√ß√£o'},
        {'name': 'Pap√©is', 'description': 'Pap√©is para impress√£o, embalagem e decora√ß√£o'},
        {'name': 'Tintas', 'description': 'Tintas para tecidos, pap√©is e superf√≠cies diversas'},
        {'name': 'Acess√≥rios', 'description': 'Linhas, bot√µes, z√≠peres e outros acess√≥rios'},
        {'name': 'Ferramentas', 'description': 'Ferramentas para corte, costura e acabamento'},
    ]

    created_categories = []
    for cat_data in categories_data:
        category, created = Category.objects.get_or_create(
            name=cat_data['name'],
            defaults={'description': cat_data['description']}
        )
        created_categories.append(category)
        if created:
            print(f"Categoria criada: {category.name}")

    # Criar produtos de exemplo para empresa de tecidos, pap√©is e tintas
    products_data = [
        {
            'name': 'Tecido Algod√£o 100% - Branco',
            'description': 'Tecido de algod√£o 100% branco, ideal para confec√ß√£o de camisetas',
            'sku': 'TEC-ALG-BRANCO-001',
            'category': created_categories[0],
            'price': Decimal('25.90'),
            'quantity': 50,
            'min_quantity': 10,
        },
        {
            'name': 'Tecido Jeans Azul - 1 metro',
            'description': 'Tecido jeans azul escuro, perfeito para cal√ßas e jaquetas',
            'sku': 'TEC-JEANS-AZUL-001',
            'category': created_categories[0],
            'price': Decimal('35.90'),
            'quantity': 30,
            'min_quantity': 8,
        },
        {
            'name': 'Papel A4 75g - Pacote 500 folhas',
            'description': 'Papel A4 branco 75g, ideal para impress√£o e escrit√≥rio',
            'sku': 'PAP-A4-75G-001',
            'category': created_categories[1],
            'price': Decimal('18.90'),
            'quantity': 100,
            'min_quantity': 20,
        },
        {
            'name': 'Papel Kraft Marrom - 1 metro',
            'description': 'Papel kraft marrom para embalagem e decora√ß√£o',
            'sku': 'PAP-KRAFT-MARROM-001',
            'category': created_categories[1],
            'price': Decimal('12.50'),
            'quantity': 80,
            'min_quantity': 15,
        },
        {
            'name': 'Tinta para Tecido - Azul',
            'description': 'Tinta especial para tecidos, cor azul, resistente √† lavagem',
            'sku': 'TIN-TECIDO-AZUL-001',
            'category': created_categories[2],
            'price': Decimal('8.90'),
            'quantity': 25,
            'min_quantity': 5,
        },
        {
            'name': 'Tinta Acr√≠lica Branca - 500ml',
            'description': 'Tinta acr√≠lica branca para papel e superf√≠cies diversas',
            'sku': 'TIN-ACRILICA-BRANCA-001',
            'category': created_categories[2],
            'price': Decimal('15.90'),
            'quantity': 40,
            'min_quantity': 8,
        },
        {
            'name': 'Linha de Costura Branca - 100m',
            'description': 'Linha de costura branca 100% poli√©ster, resistente',
            'sku': 'LIN-COSTURA-BRANCA-001',
            'category': created_categories[3],
            'price': Decimal('3.50'),
            'quantity': 200,
            'min_quantity': 50,
        },
        {
            'name': 'Bot√µes de Pl√°stico Brancos - Pacote 50',
            'description': 'Bot√µes de pl√°stico brancos, tamanho m√©dio',
            'sku': 'BOT-PLASTICO-BRANCO-001',
            'category': created_categories[3],
            'price': Decimal('12.90'),
            'quantity': 15,
            'min_quantity': 5,
        },
        {
            'name': 'Tesoura para Tecido - 20cm',
            'description': 'Tesoura profissional para corte de tecidos',
            'sku': 'TES-TECIDO-20CM-001',
            'category': created_categories[4],
            'price': Decimal('45.90'),
            'quantity': 8,
            'min_quantity': 2,
        },
        {
            'name': 'R√©gua de Corte - 60cm',
            'description': 'R√©gua de corte transparente com marca√ß√µes precisas',
            'sku': 'REG-CORTE-60CM-001',
            'category': created_categories[4],
            'price': Decimal('28.90'),
            'quantity': 12,
            'min_quantity': 3,
        },
    ]

    created_products = []
    for prod_data in products_data:
        product, created = Product.objects.get_or_create(
            sku=prod_data['sku'],
            defaults=prod_data
        )
        created_products.append(product)
        if created:
            print(f"Produto criado: {product.name}")

    # Criar algumas movimenta√ß√µes de exemplo
    movements_data = [
        {
            'product': created_products[0],
            'movement_type': 'in',
            'quantity': 20,
            'reason': 'Compra de estoque inicial',
            'notes': 'Entrada inicial de tecido algod√£o',
            'user': admin_user,
        },
        {
            'product': created_products[2],
            'movement_type': 'in',
            'quantity': 50,
            'reason': 'Reposi√ß√£o de estoque',
            'notes': 'Reposi√ß√£o de papel A4',
            'user': admin_user,
        },
        {
            'product': created_products[4],
            'movement_type': 'out',
            'quantity': 5,
            'reason': 'Venda',
            'notes': 'Venda de tinta para tecido',
            'user': admin_user,
        },
        {
            'product': created_products[6],
            'movement_type': 'adjustment',
            'quantity': 180,
            'reason': 'Ajuste de invent√°rio',
            'notes': 'Ajuste ap√≥s contagem f√≠sica',
            'user': admin_user,
        },
    ]

    for mov_data in movements_data:
        movement, created = StockMovement.objects.get_or_create(
            product=mov_data['product'],
            movement_type=mov_data['movement_type'],
            quantity=mov_data['quantity'],
            reason=mov_data['reason'],
            defaults={
                'notes': mov_data['notes'],
                'user': mov_data['user'],
            }
        )
        if created:
            print(f"Movimenta√ß√£o criada: {movement}")

    print("\n‚úÖ Dados iniciais criados com sucesso!")
    print(f"üìä Total de categorias: {Category.objects.count()}")
    print(f"üì¶ Total de produtos: {Product.objects.count()}")
    print(f"üìà Total de movimenta√ß√µes: {StockMovement.objects.count()}")
    print(f"üë§ Usu√°rio admin: admin / admin123")
    
    # Criar dados de exemplo para clientes
    clients_data = [
        {
            'name': 'Maria Silva',
            'type': 'individual',
            'cpf_cnpj': '111.444.777-35',
            'email': 'maria.silva@email.com',
            'phone': '(11) 9999-1111',
            'cellphone': '(11) 9999-1111',
            'address': 'Rua das Flores, 123',
            'city': 'S√£o Paulo',
            'state': 'SP',
            'zip_code': '01234-567',
            'notes': 'Cliente preferencial',
        },
        {
            'name': 'Jo√£o Santos',
            'type': 'individual',
            'cpf_cnpj': '222.555.888-46',
            'email': 'joao.santos@email.com',
            'phone': '(11) 8888-2222',
            'cellphone': '(11) 8888-2222',
            'address': 'Av. Paulista, 456',
            'city': 'S√£o Paulo',
            'state': 'SP',
            'zip_code': '01310-100',
            'notes': 'Cliente frequente',
        },
        {
            'name': 'Confecc√µes ABC Ltda',
            'type': 'company',
            'cpf_cnpj': '12.345.678/0001-90',
            'email': 'contato@confeccoesabc.com',
            'phone': '(11) 3333-3333',
            'cellphone': '(11) 9999-3333',
            'address': 'Rua Industrial, 789',
            'city': 'S√£o Paulo',
            'state': 'SP',
            'zip_code': '03123-456',
            'notes': 'Empresa de confec√ß√£o',
        },
        {
            'name': 'Ana Costa',
            'type': 'individual',
            'cpf_cnpj': '333.666.999-57',
            'email': 'ana.costa@email.com',
            'phone': '(11) 7777-3333',
            'cellphone': '(11) 7777-3333',
            'address': 'Rua da Paz, 321',
            'city': 'S√£o Paulo',
            'state': 'SP',
            'zip_code': '04567-890',
            'notes': 'Cliente novo',
        },
    ]

    for client_data in clients_data:
        client, created = Client.objects.get_or_create(
            cpf_cnpj=client_data['cpf_cnpj'],
            defaults=client_data
        )
        if created:
            print(f"Cliente criado: {client}")

    # Criar dados de exemplo para fornecedores
    suppliers_data = [
        {
            'name': 'Tecidos ABC Ltda',
            'type': 'company',
            'cpf_cnpj': '11.222.333/0001-81',
            'email': 'contato@tecidosabc.com',
            'phone': '(11) 3333-4444',
            'cellphone': '(11) 9999-4444',
            'address': 'Rua dos Tecidos, 100',
            'city': 'S√£o Paulo',
            'state': 'SP',
            'zip_code': '01234-567',
            'contact_person': 'Maria Santos',
            'payment_terms': '30 dias',
            'delivery_time': '7 dias √∫teis',
            'notes': 'Fornecedor principal de tecidos',
        },
        {
            'name': 'Pap√©is & Cia Ltda',
            'type': 'company',
            'cpf_cnpj': '22.333.444/0001-92',
            'email': 'vendas@papeisecia.com',
            'phone': '(11) 4444-5555',
            'cellphone': '(11) 9999-5555',
            'address': 'Av. dos Pap√©is, 200',
            'city': 'S√£o Paulo',
            'state': 'SP',
            'zip_code': '02345-678',
            'contact_person': 'Carlos Oliveira',
            'payment_terms': '15 dias',
            'delivery_time': '5 dias √∫teis',
            'notes': 'Especialista em pap√©is especiais',
        },
        {
            'name': 'Tintas Coloridas Ltda',
            'type': 'company',
            'cpf_cnpj': '33.444.555/0001-03',
            'email': 'comercial@tintascoloridas.com',
            'phone': '(11) 5555-6666',
            'cellphone': '(11) 9999-6666',
            'address': 'Rua das Tintas, 300',
            'city': 'S√£o Paulo',
            'state': 'SP',
            'zip_code': '03456-789',
            'contact_person': 'Pedro Lima',
            'payment_terms': '45 dias',
            'delivery_time': '10 dias √∫teis',
            'notes': 'Fornecedor de tintas profissionais',
        },
        {
            'name': 'Acess√≥rios R√°pidos',
            'type': 'company',
            'cpf_cnpj': '44.555.666/0001-14',
            'email': 'pedidos@acessoriosrapidos.com',
            'phone': '(11) 6666-7777',
            'cellphone': '(11) 9999-7777',
            'address': 'Rua dos Acess√≥rios, 400',
            'city': 'S√£o Paulo',
            'state': 'SP',
            'zip_code': '04567-890',
            'contact_person': 'Fernanda Costa',
            'payment_terms': '20 dias',
            'delivery_time': '3 dias √∫teis',
            'notes': 'Entrega r√°pida de acess√≥rios',
        },
    ]

    for supplier_data in suppliers_data:
        supplier, created = Supplier.objects.get_or_create(
            cpf_cnpj=supplier_data['cpf_cnpj'],
            defaults=supplier_data
        )
        if created:
            print(f"Fornecedor criado: {supplier}")

    print(f"üë• Total de clientes: {Client.objects.count()}")
    print(f"üöö Total de fornecedores: {Supplier.objects.count()}")

if __name__ == '__main__':
    create_initial_data()

